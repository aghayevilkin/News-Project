@model VmBase
@inject SignInManager<IdentityUser> SignInManager
@inject UserManager<IdentityUser> _userManager;
@inject AppDbContext _context
@{
    ViewData["Title"] = "Home Page";
}

<!-- Feature post -->
<section class="bg0">
    <div class="container">
        <div class="row m-rl--1">
            @foreach (var item in Model.News.OrderByDescending(aa => aa.AddedDate).Take(1))
            {
                <div class="col-md-6 p-rl-1 p-b-2">
                    <div class="bg-img1 size-a-3 how1 pos-relative" style="background-image: url(@Url.Content("~/Uploads/Images/News/"+item.Image)">
                        <a asp-controller="news" asp-action="details" asp-route-id="@item.Id" class="dis-block how1-child1 trans-03"></a>

                        <div class="flex-col-e-s s-full p-rl-25 p-tb-20">
                            <a asp-controller="news" asp-action="index" asp-route-id="@item.Category.NewsCategory.Id" class="dis-block how1-child2 f1-s-2 cl0 bo-all-1 bocl0 hov-btn1 trans-03 p-rl-5 p-t-2">
                                @item.Category.NewsCategory.Name
                            </a>

                            <h3 class="how1-child2 m-t-14 m-b-10">
                                <a asp-controller="news" asp-action="details" asp-route-id="@item.Id" class="how-txt1 size-a-6 f1-l-1 cl0 hov-cl10 trans-03">
                                    @item.Title
                                </a>
                            </h3>

                            <span class="how1-child2">
                                <span class="f1-s-4 cl11">
                                    @item.User.Name @item.User.Surname
                                </span>

                                <span class="f1-s-3 cl11 m-rl-3">
                                    -
                                </span>

                                <span class="f1-s-3 cl11">
                                    @item.AddedDate.Date.ToString("dd MMM")
                                </span>
                            </span>
                        </div>
                    </div>
                </div>
            }


            <div class="col-md-6 p-rl-1">
                <div class="row m-rl--1">
                    @foreach (var item in Model.News.OrderByDescending(aa => aa.AddedDate).Skip(1).Take(1))
                            {
                        <div class="col-12 p-rl-1 p-b-2">
                            <div class="bg-img1 size-a-4 how1 pos-relative" style="background-image: url(@Url.Content("~/Uploads/Images/News/"+item.Image)">
                                <a asp-controller="news" asp-action="details" asp-route-id="@item.Id" class="dis-block how1-child1 trans-03"></a>

                                <div class="flex-col-e-s s-full p-rl-25 p-tb-24">
                                    <a asp-controller="news" asp-action="index" asp-route-id="@item.Category.NewsCategory.Id" class="dis-block how1-child2 f1-s-2 cl0 bo-all-1 bocl0 hov-btn1 trans-03 p-rl-5 p-t-2">
                                        @item.Category.NewsCategory.Name
                                    </a>

                                    <h3 class="how1-child2 m-t-14">
                                        <a asp-controller="news" asp-action="details" asp-route-id="@item.Id" class="how-txt1 size-a-7 f1-l-2 cl0 hov-cl10 trans-03">
                                            @item.Title
                                        </a>
                                    </h3>
                                </div>
                            </div>
                        </div>
                    }


                    @foreach (var item in Model.News.OrderByDescending(aa => aa.AddedDate).Skip(2).Take(2))
                    {
                        <div class="col-sm-6 p-rl-1 p-b-2">
                            <div class="bg-img1 size-a-5 how1 pos-relative" style="background-image: url(@Url.Content("~/Uploads/Images/News/"+item.Image)">
                                <a asp-controller="news" asp-action="details" asp-route-id="@item.Id" class="dis-block how1-child1 trans-03"></a>

                                <div class="flex-col-e-s s-full p-rl-25 p-tb-20">
                                    <a asp-controller="news" asp-action="index" asp-route-id="@item.Category.NewsCategory.Id" class="dis-block how1-child2 f1-s-2 cl0 bo-all-1 bocl0 hov-btn1 trans-03 p-rl-5 p-t-2">
                                        @item.Category.NewsCategory.Name
                                    </a>

                                    <h3 class="how1-child2 m-t-14">
                                        <a asp-controller="news" asp-action="details" asp-route-id="@item.Id" class="how-txt1 size-h-1 f1-m-1 cl0 hov-cl10 trans-03">
                                            @item.Title
                                        </a>
                                    </h3>
                                </div>
                            </div>
                        </div>
                    }

                </div>
            </div>
        </div>
    </div>
</section>

<!-- Post -->
<section class="bg0 p-t-70">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-10 col-lg-8">
                <div class="p-b-20">
                    <!-- Entertainment -->
                    @foreach (var item in Model.Categories)
                    {
                        <div class="tab01 p-b-20">
                            <div class="tab01-head how2 how2-cl1 bocl12 flex-s-c m-r-10 m-r-0-sr991">
                                <!-- Brand tab -->
                                <h3 class="f1-m-2 cl12 tab01-title">
                                    @item.Name
                                </h3>

                                <!-- Nav tabs -->
                                <ul class="nav nav-tabs" role="tablist">
                                    @{
                                        var i = 1;
                                    }
                                    @foreach (var item2 in item.NewsSubCategories)
                                    {
                                        @if (item2.News.Count != 0)
                                        {
                                            <li class="nav-item">
                                            <a class="nav-link @(i == 1?"active":"")" data-toggle="tab" href="#tab-@item.Id-@item2.Id" role="tab">@item2.Name</a>
                                            </li>
                                            i = 0;
                                        }
                                    }

                                    <li class="nav-item-more dropdown dis-none">
                                        <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">
                                            <i class="fa fa-ellipsis-h"></i>
                                        </a>

                                        <ul class="dropdown-menu">
                                        </ul>
                                    </li>
                                </ul>

                                <!--  -->
                                <a asp-controller="news" asp-action="index" asp-route-id="@item.Id" class="tab01-link f1-s-1 cl9 hov-cl10 trans-03">
                                    View all
                                    <i class="fs-12 m-l-5 fa fa-caret-right"></i>
                                </a>
                            </div>


                            <!-- Tab panes -->
                            <div class="tab-content p-t-35">
                                <!-- - -->
                                @{
                                    i = 1;
                                }
                                @foreach (var item2 in item.NewsSubCategories)
                                {
                                    <div class="tab-pane fade show @(i == 1?"active":"")" id="tab-@item.Id-@item2.Id" role="tabpanel">
                                        <div class="row">
                                            @foreach (var news in item2.News.Take(4))
                                            {
                                                <div class="col-sm-6 p-r-25 p-r-15-sr991">
                                                    <!-- Item post -->
                                                    <div class="m-b-45">
                                                        <a asp-controller="news" asp-action="details" asp-route-id="@news.Id" class="wrap-pic-w hov1 trans-03 news-clip-path">
                                                            <img style="background-size: cover; background-position: center center; height: 225px; " src="~/Uploads/Images/News/@news.Image" alt="IMG">
                                                        </a>

                                                        <div class="news-content">
                                                            <span class="f1-s-3 cateBlog">
                                                                <span class="dis-block how1-child2 f1-s-5 cl0 bo-all-1 trans-03 p-rl-5 p-t-2"
                                                                      style="color: #aaaaaa; border-color: #aaaaaa; ">
                                                                    @news.Category.NewsCategory.Name
                                                                </span>
                                                                @if (SignInManager.IsSignedIn(User))
                                                                {
                                                                    <i class="@(news.SavedNews.Any(s => s.UserId == ViewBag.UserId) == true ? "fas added" : "far")  fa-bookmark fa-2x blog-bookmarked" data-id="@news.Id"></i>
                                                                }

                                                            </span>

                                                            <div class="when">
                                                                <div class="when-date">
                                                                    <div class="date-day">@news.AddedDate.Date.ToString("dd")</div>
                                                                    <div class="date-month">@news.AddedDate.Date.ToString("MMM")</div>
                                                                    <div class="date-year" style="display:none;">
                                                                        @news.AddedDate.Date.ToString("yyyy")
                                                                    </div>
                                                                </div>
                                                                <div class="when-time">@news.AddedDate.ToString("HH:mm")</div>
                                                            </div>


                                                            <div class="p-t-16">
                                                                <h5 class="p-b-5 m-2">
                                                                    <a asp-controller="news" asp-action="details" asp-route-id="@news.Id" class="f1-m-3 cl2 hov-cl10 trans-03">
                                                                        @news.Title
                                                                    </a>
                                                                </h5>

                                                                @{
                                                                    var userId = _userManager.GetUserId(User);

                                                                    List<LikeAndDislike> LikeCount = _context.LikeAndDislikes.Where(aa => aa.NewsId == news.Id && aa.LikeAndDislikeStatus == LikeAndDislikeStatus.Like).ToList();
                                                                    List<LikeAndDislike> DislikeCount = _context.LikeAndDislikes.Where(aa => aa.NewsId == news.Id && aa.LikeAndDislikeStatus == LikeAndDislikeStatus.Dislike).ToList();
                                                                    List<LikeAndDislike> LikeIcon = _context.LikeAndDislikes.Where(aa => aa.NewsId == news.Id && aa.UserId == userId && aa.LikeAndDislikeStatus == LikeAndDislikeStatus.Like).ToList();
                                                                    List<LikeAndDislike> DislikeIcon = _context.LikeAndDislikes.Where(aa => aa.NewsId == news.Id && aa.UserId == userId && aa.LikeAndDislikeStatus == LikeAndDislikeStatus.Dislike).ToList();

                                                                    var Likecount = LikeCount.Count;
                                                                    var Dislikecount = DislikeCount.Count;

                                                                    var aa = 0;
                                                                    var bb = "";
                                                                    var cc = "";

                                                                    foreach (var likeicon in LikeIcon)
                                                                    {
                                                                        aa = (int)likeicon.LikeAndDislikeStatus;

                                                                        if (aa == 1)
                                                                        {
                                                                            bb = "like-added";
                                                                        }
                                                                        else
                                                                        {
                                                                            bb = "";
                                                                        }

                                                                    }

                                                                    foreach (var dislikeicon in DislikeIcon)
                                                                    {
                                                                        aa = (int)dislikeicon.LikeAndDislikeStatus;

                                                                        if (aa == 2)
                                                                        {
                                                                            cc = "dislike-added";
                                                                        }
                                                                        else
                                                                        {
                                                                            cc = "";
                                                                        }

                                                                    }


                                                                }

                                                                <div class="stats">
                                                                    <div class="stats-i-container stats-like-active stats_likes @(SignInManager.IsSignedIn(User)==true?"news-like":"like-hover")  @bb"
                                                                         data-id="@news.Id"
                                                                         data-likecount="@Likecount">

                                                                        <span class="stats-i">
                                                                            <i class="fas fa-thumbs-up likeCount">@Likecount</i>
                                                                        </span>
                                                                    </div>
                                                                    <div class="stats-i-container stats-like-active stats_dislikes @(SignInManager.IsSignedIn(User)==true?"news-dislike":"dislike-hover") @cc"
                                                                         data-id="@news.Id"
                                                                         data-dislikecount="@Dislikecount">
                                                                        <span class="stats-i"><i class="fas fa-thumbs-down dislikeCount"></i>@Dislikecount</span>
                                                                    </div>
                                                                    <div class="stats-i-container stats_views">
                                                                        <span class="stats-i"><i class="fas fa-eye"></i> @news.ViewCount</span>
                                                                    </div>
                                                                </div>


                                                            </div>
                                                        </div>


                                                    </div>
                                                </div>
                                                i = 0;
                                            }



                                        </div>
                                    </div>
                                }



                            </div>
                        </div>
                    }



                </div>
            </div>

            <div class="col-md-10 col-lg-4">
                <div class="p-l-10 p-rl-0-sr991 p-b-20">
                    <!--  -->
                    <div>
                        <div class="how2 how2-cl4 flex-s-c">
                            <h3 class="f1-m-2 cl3 tab01-title">
                                Most Popular
                            </h3>
                        </div>

                        <ul class="p-t-35">
                            @{ var k = 1;}
                            @foreach (var item in Model.News.Where(aa=>aa.LikeAndDislikes.Any(bb=>bb.LikeAndDislikeStatus==LikeAndDislikeStatus.Like)).OrderByDescending(cc=>cc.LikeAndDislikes.Count).Take(5))
                            {
                                <li class="flex-wr-sb-s p-b-22">
                                    <div class="size-a-8 flex-c-c borad-3 size-a-8 bg9 f1-m-4 cl0 m-b-6">
                                        @k
                                    </div>

                                    <a asp-controller="news" asp-action="details" asp-route-id="@item.Id" class="size-w-3 f1-s-7 cl3 hov-cl10 trans-03">
                                        @item.Title
                                    </a>
                                </li>
                                k++;
                            }

                        </ul>
                    </div>


                    <!--  -->
                    <div class="p-t-50">
                        <div class="how2 how2-cl4 flex-s-c">
                            <h3 class="f1-m-2 cl3 tab01-title">
                                Stay Connected
                            </h3>
                        </div>

                        <ul class="p-t-35">
                            <li class="flex-wr-sb-c p-b-20">
                                <a href="#" class="size-a-8 flex-c-c borad-3 size-a-8 bg-facebook fs-16 cl0 hov-cl0">
                                    <span class="fab fa-facebook-f"></span>
                                </a>

                                <div class="size-w-3 flex-wr-sb-c">
                                    <span class="f1-s-8 cl3 p-r-20">
                                        6879 Fans
                                    </span>

                                    <a href="#" class="f1-s-9 text-uppercase cl3 hov-cl10 trans-03">
                                        Like
                                    </a>
                                </div>
                            </li>

                            <li class="flex-wr-sb-c p-b-20">
                                <a href="#" class="size-a-8 flex-c-c borad-3 size-a-8 bg-twitter fs-16 cl0 hov-cl0">
                                    <span class="fab fa-twitter"></span>
                                </a>

                                <div class="size-w-3 flex-wr-sb-c">
                                    <span class="f1-s-8 cl3 p-r-20">
                                        568 Followers
                                    </span>

                                    <a href="#" class="f1-s-9 text-uppercase cl3 hov-cl10 trans-03">
                                        Follow
                                    </a>
                                </div>
                            </li>

                            <li class="flex-wr-sb-c p-b-20">
                                <a href="#" class="size-a-8 flex-c-c borad-3 size-a-8 bg-youtube fs-16 cl0 hov-cl0">
                                    <span class="fab fa-youtube"></span>
                                </a>

                                <div class="size-w-3 flex-wr-sb-c">
                                    <span class="f1-s-8 cl3 p-r-20">
                                        5039 Subscribers
                                    </span>

                                    <a href="#" class="f1-s-9 text-uppercase cl3 hov-cl10 trans-03">
                                        Subscribe
                                    </a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


<!-- Latest -->
<section class="bg0 p-t-60 p-b-35">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-10 col-lg-8 p-b-20">
                <div class="how2 how2-cl4 flex-s-c m-r-10 m-r-0-sr991">
                    <h3 class="f1-m-2 cl3 tab01-title">
                        Latest Articles
                    </h3>
                </div>

                <div class="row p-t-35">
                    @foreach (var item in Model.LatestArticles)
                    {
                        <div class="col-sm-6 p-r-25 p-r-15-sr991">
                            <!-- Item latest -->
                            <div class="m-b-45">
                                <a asp-controller="news" asp-action="details" asp-route-id="@item.Id" class="wrap-pic-w hov1 trans-03">
                                    <img style="background-size: cover; background-position: center center; height: 225px; " src="~/Uploads/Images/News/@item.Image" alt="IMG">
                                </a>

                                <div class="p-t-16">
                                    <h5 class="p-b-5">
                                        <a asp-controller="news" asp-action="details" asp-route-id="@item.Id" class="f1-m-3 cl2 hov-cl10 trans-03">
                                            @item.Title
                                        </a>
                                    </h5>

                                    <span class="cl8">
                                        <a href="#" class="f1-s-4 cl8 hov-cl10 trans-03">
                                            @item.User.Name @item.User.Surname
                                        </a>

                                        <span class="f1-s-3 m-rl-3">
                                            -
                                        </span>

                                        <span class="f1-s-3">
                                            @item.AddedDate.ToString("HH:mm")
                                        </span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    }

                </div>
            </div>

            <div class="col-md-10 col-lg-4">
                <div class="p-l-10 p-rl-0-sr991 p-b-20">

                    <!-- Subscribe -->
                    <div class="bg10 p-rl-35 p-t-28 p-b-35 m-b-55">
                        <h5 class="f1-m-5 cl0 p-b-10">
                            Subscribe
                        </h5>

                        <p class="f1-s-1 cl0 p-b-25">
                            Get all latest content delivered to your email a few times a month.
                        </p>

                        <form class="size-a-9 pos-relative" id="subscribe-form" method="post">
                            <input class="s-full f1-m-6 cl6 plh9 p-l-20 p-r-55" type="email" id="subscribe-input" placeholder="Email">

                            <button type="submit" class="size-a-10 flex-c-c ab-t-r fs-16 cl9 hov-cl10 trans-03">
                                <i class="fa fa-arrow-right"></i>
                            </button>
                        </form>
                    </div>

                    <!-- Tag -->
                    <div class="p-b-55">
                        <div class="how2 how2-cl4 flex-s-c m-b-30">
                            <h3 class="f1-m-2 cl3 tab01-title">
                                Tags
                            </h3>
                        </div>

                        <div class="flex-wr-s-s m-rl--5">
                            @foreach (NewsTag tag in Model.Tags)
                            {
                                if (tag.TagToNews.Count != 0)
                                {
                                    <a asp-controller="news" asp-action="index" asp-route-tagId="@tag.Id" class="flex-c-c size-h-2 bo-1-rad-20 bocl12 f1-s-1 cl8 hov-btn2 trans-03 p-rl-20 p-tb-5 m-all-5">
                                        @tag.Name
                                    </a>
                                }
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>